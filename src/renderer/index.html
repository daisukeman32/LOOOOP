<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src 'self' file: data:; img-src 'self' data:;">
    <title>LOOOOP - プロフェッショナル向けループ動画作成ツール</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- メイン画面レイアウト -->
        <div class="main-layout">
            <!-- 左側: メディアプール -->
            <div class="media-pool">
                <h3>メディアプール</h3>
                <div class="media-pool-content" id="mediaPool">
                    <div class="import-area" id="importArea">
                        <div class="import-placeholder">
                            <div class="import-icon">📁</div>
                            <p>動画ファイルをドロップ<br>または</p>
                            <button class="import-button" id="importButton">インポート</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中央: プレビューパネル -->
            <div class="preview-panel">
                <h3>ループ動画プレビュー</h3>
                <div class="preview-content">
                    <div class="video-container" id="videoContainer">
                        <!-- Canvas要素でループプレビュー -->
                        <canvas id="previewCanvas" width="640" height="480"></canvas>
                        <!-- 隠しVideo要素（フレーム抽出用） -->
                        <video id="hiddenVideo" style="display: none;" preload="metadata" muted></video>
                        <div class="preview-overlay" id="previewOverlay">
                            <div class="preview-placeholder">
                                <div class="preview-icon">🎬</div>
                                <p>動画をセットしてループプレビューを開始</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- シークバー -->
                    <div class="seekbar-container">
                        <div class="seekbar" id="seekbar">
                            <div class="seekbar-track" id="seekbarTrack">
                                <div class="seekbar-progress" id="seekbarProgress"></div>
                                <div class="seekbar-thumb" id="seekbarThumb"></div>
                                <!-- ループマーカー -->
                                <div class="loop-markers" id="loopMarkers"></div>
                            </div>
                        </div>
                        <div class="frame-info">
                            <span id="currentFrame">0</span> / <span id="totalFrames">0</span> frames | 
                            ループ <span id="currentLoop">0</span> / <span id="totalLoops">0</span>
                        </div>
                    </div>
                    
                    <div class="preview-controls">
                        <button class="control-btn" id="playBtn">▶️</button>
                        <button class="control-btn" id="pauseBtn" style="display: none;">⏸️</button>
                        <button class="control-btn" id="stopBtn">⏹️</button>
                        <span class="time-display" id="timeDisplay">00:00 / 00:00</span>
                    </div>
                </div>
            </div>

            <!-- 右側: インスペクター -->
            <div class="inspector">
                <h3>インスペクター</h3>
                <div class="inspector-content" id="inspector">
                    <div class="inspector-section">
                        <label>ループ回数:</label>
                        <input type="number" id="loopCount" min="1" max="99" value="3">
                        <button class="set-button" id="setToTimeline">セット</button>
                    </div>
                    
                    <div class="inspector-section">
                        <label>速度パターン:</label>
                        <div class="speed-pattern-selector">
                            <select id="speedPreset" class="speed-preset-select">
                                <option value="linear">一定速度</option>
                                <option value="easeIn">スロースタート</option>
                                <option value="easeOut">スローフィニッシュ</option>
                                <option value="easeInOut">スロースタート&フィニッシュ</option>
                                <option value="bounce">バウンス</option>
                                <option value="custom">カスタム</option>
                            </select>
                        </div>
                        
                        <div id="customSpeedControls" class="custom-speed-controls" style="display: none;">
                            <label class="speed-slider-label">開始速度: <span id="startSpeedValue">1.0x</span></label>
                            <input type="range" id="startSpeedSlider" min="0.1" max="3.0" step="0.1" value="1.0" class="speed-slider">
                            
                            <label class="speed-slider-label">中間速度: <span id="midSpeedValue">1.0x</span></label>
                            <input type="range" id="midSpeedSlider" min="0.1" max="3.0" step="0.1" value="1.0" class="speed-slider">
                            
                            <label class="speed-slider-label">終了速度: <span id="endSpeedValue">1.0x</span></label>
                            <input type="range" id="endSpeedSlider" min="0.1" max="3.0" step="0.1" value="1.0" class="speed-slider">
                        </div>
                        
                        <div class="speed-curve-preview">
                            <label>速度プレビュー:</label>
                            <canvas id="speedPreviewCanvas" width="280" height="120"></canvas>
                        </div>
                        
                        <button class="apply-button" id="applySpeedCurve">速度パターン適用</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 下部: タイムライン -->
        <div class="timeline-panel">
            <h3>タイムライン</h3>
            
            <!-- シークバーとコントロール -->
            <div class="timeline-seekbar-container">
                <div class="playback-controls">
                    <button id="playBtn" class="control-btn">▶️</button>
                    <button id="pauseBtn" class="control-btn" style="display: none;">⏸️</button>
                    <button id="stopBtn" class="control-btn">⏹️</button>
                </div>
                <div class="seekbar-container">
                    <input type="range" id="timelineSeekbar" class="timeline-seekbar" min="0" max="100" value="0">
                    <div class="time-display">
                        <span id="currentTimeDisplay">00:00</span>
                        <span>/</span>
                        <span id="totalTimeDisplay">00:00</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-content" id="timeline">
                <div class="timeline-ruler">
                    <div class="ruler-markers" id="rulerMarkers"></div>
                </div>
                <div class="timeline-track" id="timelineTrack">
                    <div class="timeline-placeholder">
                        <p>ここにクリップをセットして編集を開始</p>
                    </div>
                    <div class="playhead" id="playhead"></div>
                </div>
                <div class="timeline-controls">
                    <span class="timeline-info" id="timelineInfo">セット待機中...</span>
                    <div class="timeline-help">
                        <small>💡 ドラッグで並び替え | Ctrl+S: セット | Space: 再生/停止 | ←→: フレーム移動</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ファイル入力（非表示） -->
    <input type="file" id="fileInput" accept="video/*" style="display: none;" multiple>
    
    <script src="app.js"></script>
</body>
</html>