<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; media-src 'self' file: data:; img-src 'self' data:;">
    <title>LOOOOP - „Éó„É≠„Éï„Çß„ÉÉ„Ç∑„Éß„Éä„É´Âêë„Åë„É´„Éº„ÉóÂãïÁîª‰ΩúÊàê„ÉÑ„Éº„É´</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- „É°„Ç§„É≥ÁîªÈù¢„É¨„Ç§„Ç¢„Ç¶„Éà -->
        <div class="main-layout">
            <!-- Â∑¶ÂÅ¥: „É°„Éá„Ç£„Ç¢„Éó„Éº„É´ -->
            <div class="media-pool">
                <h3>„É°„Éá„Ç£„Ç¢„Éó„Éº„É´</h3>
                <div class="media-pool-content" id="mediaPool">
                    <div class="import-area" id="importArea">
                        <div class="import-placeholder">
                            <div class="import-icon">üìÅ</div>
                            <p>ÂãïÁîª„Éï„Ç°„Ç§„É´„Çí„Éâ„É≠„ÉÉ„Éó<br>„Åæ„Åü„ÅØ</p>
                            <button class="import-button" id="importButton">„Ç§„É≥„Éù„Éº„Éà</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‰∏≠Â§Æ: „Éó„É¨„Éì„É•„Éº„Éë„Éç„É´ -->
            <div class="preview-panel">
                <h3>„É´„Éº„ÉóÂãïÁîª„Éó„É¨„Éì„É•„Éº</h3>
                <div class="preview-content">
                    <div class="video-container" id="videoContainer">
                        <!-- CanvasË¶ÅÁ¥†„Åß„É´„Éº„Éó„Éó„É¨„Éì„É•„Éº -->
                        <canvas id="previewCanvas" width="640" height="480"></canvas>
                        <!-- Èö†„ÅóVideoË¶ÅÁ¥†Ôºà„Éï„É¨„Éº„É†ÊäΩÂá∫Áî®Ôºâ -->
                        <video id="hiddenVideo" style="display: none;" preload="metadata" muted></video>
                        <div class="preview-overlay" id="previewOverlay">
                            <div class="preview-placeholder">
                                <div class="preview-icon">üé¨</div>
                                <p>ÂãïÁîª„Çí„Çª„ÉÉ„Éà„Åó„Å¶„É´„Éº„Éó„Éó„É¨„Éì„É•„Éº„ÇíÈñãÂßã</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- „Ç∑„Éº„ÇØ„Éê„Éº -->
                    <div class="seekbar-container">
                        <div class="seekbar" id="seekbar">
                            <div class="seekbar-track" id="seekbarTrack">
                                <div class="seekbar-progress" id="seekbarProgress"></div>
                                <div class="seekbar-thumb" id="seekbarThumb"></div>
                                <!-- „É´„Éº„Éó„Éû„Éº„Ç´„Éº -->
                                <div class="loop-markers" id="loopMarkers"></div>
                            </div>
                        </div>
                        <div class="frame-info">
                            <span id="currentFrame">0</span> / <span id="totalFrames">0</span> frames | 
                            „É´„Éº„Éó <span id="currentLoop">0</span> / <span id="totalLoops">0</span>
                        </div>
                    </div>
                    
                    <!-- ÈÄüÂ∫¶Êõ≤Á∑ö„Ç®„Éá„Ç£„ÇøÔºà„ÉØ„Ç§„ÉâË°®Á§∫Ôºâ -->
                    <div class="speed-curve-editor-wide">
                        <div class="speed-curve-header">
                            <h4>ÈÄüÂ∫¶Êõ≤Á∑ö„Ç®„Éá„Ç£„Çø</h4>
                            <div class="speed-curve-buttons">
                                <button class="reset-button" id="resetSpeedCurveWide">„É™„Çª„ÉÉ„Éà</button>
                                <button class="apply-button" id="applySpeedCurveWide">ÈÅ©Áî®</button>
                            </div>
                        </div>
                        <svg id="speedCurveSvgWide" width="100%" height="160">
                            <defs>
                                <!-- È´òÁ≤æÂ∫¶„Ç∞„É™„ÉÉ„Éâ -->
                                <pattern id="fineGridWide" width="10" height="10" patternUnits="userSpaceOnUse">
                                    <path d="M 10 0 L 0 0 0 10" fill="none" stroke="#252525" stroke-width="0.5"/>
                                </pattern>
                                <pattern id="majorGridWide" width="40" height="40" patternUnits="userSpaceOnUse">
                                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#404040" stroke-width="1"/>
                                </pattern>
                                <!-- „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ -->
                                <linearGradient id="speedGradientWide" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ff4444;stop-opacity:0.15" />
                                    <stop offset="25%" style="stop-color:#ffaa44;stop-opacity:0.1" />
                                    <stop offset="50%" style="stop-color:#ffffff;stop-opacity:0.05" />
                                    <stop offset="75%" style="stop-color:#44ffaa;stop-opacity:0.1" />
                                    <stop offset="100%" style="stop-color:#44ff44;stop-opacity:0.15" />
                                </linearGradient>
                                <!-- ÂΩ±ÂäπÊûú -->
                                <filter id="glowWide">
                                    <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
                                    <feMerge> 
                                        <feMergeNode in="coloredBlur"/>
                                        <feMergeNode in="SourceGraphic"/> 
                                    </feMerge>
                                </filter>
                            </defs>
                            
                            <!-- ËÉåÊôØ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ -->
                            <rect width="100%" height="100%" fill="url(#speedGradientWide)" />
                            
                            <!-- „Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„É§„Éº -->
                            <rect width="100%" height="100%" fill="url(#fineGridWide)" />
                            <rect width="100%" height="100%" fill="url(#majorGridWide)" />
                            
                            <!-- ÈÄüÂ∫¶„Çæ„Éº„É≥„É©„Éô„É´ -->
                            <g id="speedLabelsWide">
                                <text x="8" y="20" fill="#ff4444" font-size="9" font-family="Consolas" font-weight="bold">4.0x</text>
                                <text x="8" y="40" fill="#ff6666" font-size="9" font-family="Consolas">3.0x</text>
                                <text x="8" y="60" fill="#ffaa66" font-size="9" font-family="Consolas">2.0x</text>
                                <text x="8" y="80" fill="#ffffff" font-size="10" font-family="Consolas" font-weight="bold">1.0x</text>
                                <text x="8" y="100" fill="#aaffaa" font-size="9" font-family="Consolas">0.5x</text>
                                <text x="8" y="140" fill="#66ff66" font-size="9" font-family="Consolas">0.1x</text>
                            </g>
                            
                            <!-- ‰∏≠ÂøÉÂü∫Ê∫ñÁ∑ö -->
                            <line x1="0" y1="80" x2="100%" y2="80" stroke="#666" stroke-width="2" stroke-dasharray="8,4" opacity="0.8" />
                            
                            <!-- „Éô„Ç∏„Ç®Êõ≤Á∑ö -->
                            <path id="speedCurvePathWide" d="M0,80 C70,80 70,80 140,80 S210,80 280,80" 
                                  fill="none" stroke="#4CAF50" stroke-width="3" filter="url(#glowWide)" />
                            
                            <!-- Âà∂Âæ°„Éè„É≥„Éâ„É´Á∑ö -->
                            <g id="controlHandlesWide" opacity="0.4">
                                <line id="handle0LineWide" x1="0" y1="80" x2="0" y2="80" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                <line id="handle1LineWide" x1="70" y1="80" x2="70" y2="80" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                <line id="handle2LineWide" x1="140" y1="80" x2="140" y2="80" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                <line id="handle3LineWide" x1="210" y1="80" x2="210" y2="80" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                <line id="handle4LineWide" x1="280" y1="80" x2="280" y2="80" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                            </g>
                            
                            <!-- ÂÖ®„Ç≥„É≥„Éà„É≠„Éº„É´„Éù„Ç§„É≥„ÉàÔºà5ÁÇπÂà∂Âæ°Ôºâ -->
                            <g id="controlPointsWide">
                                <!-- Â∑¶Á´Ø„Éù„Ç§„É≥„ÉàÔºàÈñãÂßãÁÇπÔºâ -->
                                <circle id="controlPoint0Wide" cx="0" cy="80" r="6" fill="#ff6b6b" stroke="#ffffff" stroke-width="2" cursor="move" 
                                        class="control-point-wide endpoint" data-speed="1.0" />
                                <!-- ‰∏≠ÈñìÂà∂Âæ°„Éù„Ç§„É≥„Éà -->
                                <circle id="controlPoint1Wide" cx="70" cy="80" r="6" fill="#ffffff" stroke="#4CAF50" stroke-width="2" cursor="move" 
                                        class="control-point-wide" data-speed="1.0" />
                                <circle id="controlPoint2Wide" cx="140" cy="80" r="6" fill="#ffffff" stroke="#4CAF50" stroke-width="2" cursor="move" 
                                        class="control-point-wide" data-speed="1.0" />
                                <circle id="controlPoint3Wide" cx="210" cy="80" r="6" fill="#ffffff" stroke="#4CAF50" stroke-width="2" cursor="move" 
                                        class="control-point-wide" data-speed="1.0" />
                                <!-- Âè≥Á´Ø„Éù„Ç§„É≥„ÉàÔºàÁµÇ‰∫ÜÁÇπÔºâ -->
                                <circle id="controlPoint4Wide" cx="280" cy="80" r="6" fill="#ff6b6b" stroke="#ffffff" stroke-width="2" cursor="move" 
                                        class="control-point-wide endpoint" data-speed="1.0" />
                            </g>
                        </svg>
                        
                        <!-- „ÉØ„Ç§„ÉâÁâàÁ≤æÂØÜÂà∂Âæ°„Éë„Éç„É´ -->
                        <div class="curve-precision-panel-wide">
                            <div class="precision-info-wide">
                                <span class="precision-label-wide">Á≤æÂØÜÂà∂Âæ°:</span>
                                <div class="precision-values-wide">
                                    <div class="value-item-wide">
                                        <label>P0:</label>
                                        <input type="number" id="p0SpeedWide" min="0.1" max="4.0" step="0.05" value="1.0">
                                        <span>x</span>
                                    </div>
                                    <div class="value-item-wide">
                                        <label>P1:</label>
                                        <input type="number" id="p1SpeedWide" min="0.1" max="4.0" step="0.05" value="1.0">
                                        <span>x</span>
                                    </div>
                                    <div class="value-item-wide">
                                        <label>P2:</label>
                                        <input type="number" id="p2SpeedWide" min="0.1" max="4.0" step="0.05" value="1.0">
                                        <span>x</span>
                                    </div>
                                    <div class="value-item-wide">
                                        <label>P3:</label>
                                        <input type="number" id="p3SpeedWide" min="0.1" max="4.0" step="0.05" value="1.0">
                                        <span>x</span>
                                    </div>
                                    <div class="value-item-wide">
                                        <label>P4:</label>
                                        <input type="number" id="p4SpeedWide" min="0.1" max="4.0" step="0.05" value="1.0">
                                        <span>x</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥ÂÅ¥: „Ç§„É≥„Çπ„Éö„ÇØ„Çø„Éº -->
            <div class="inspector">
                <h3>„Ç§„É≥„Çπ„Éö„ÇØ„Çø„Éº</h3>
                <div class="inspector-content" id="inspector">
                    <div class="inspector-section">
                        <label>„É´„Éº„ÉóÂõûÊï∞:</label>
                        <input type="number" id="loopCount" min="1" max="99" value="3">
                        <button class="set-button" id="setToTimeline">„Çª„ÉÉ„Éà</button>
                    </div>
                    
                    <div class="inspector-section">
                        <label>ÈÄüÂ∫¶Êõ≤Á∑ö:</label>
                        <div class="speed-curve-editor-rich">
                            <svg id="speedCurveSvg" width="280" height="240">
                                <defs>
                                    <!-- È´òÁ≤æÂ∫¶„Ç∞„É™„ÉÉ„Éâ -->
                                    <pattern id="fineGrid" width="10" height="10" patternUnits="userSpaceOnUse">
                                        <path d="M 10 0 L 0 0 0 10" fill="none" stroke="#252525" stroke-width="0.5"/>
                                    </pattern>
                                    <pattern id="majorGrid" width="40" height="40" patternUnits="userSpaceOnUse">
                                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#404040" stroke-width="1"/>
                                    </pattern>
                                    <!-- „Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ -->
                                    <linearGradient id="speedGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                        <stop offset="0%" style="stop-color:#ff4444;stop-opacity:0.15" />
                                        <stop offset="25%" style="stop-color:#ffaa44;stop-opacity:0.1" />
                                        <stop offset="50%" style="stop-color:#ffffff;stop-opacity:0.05" />
                                        <stop offset="75%" style="stop-color:#44ffaa;stop-opacity:0.1" />
                                        <stop offset="100%" style="stop-color:#44ff44;stop-opacity:0.15" />
                                    </linearGradient>
                                    <!-- ÂΩ±ÂäπÊûú -->
                                    <filter id="glow">
                                        <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                        <feMerge> 
                                            <feMergeNode in="coloredBlur"/>
                                            <feMergeNode in="SourceGraphic"/> 
                                        </feMerge>
                                    </filter>
                                </defs>
                                
                                <!-- ËÉåÊôØ„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ -->
                                <rect width="100%" height="100%" fill="url(#speedGradient)" />
                                
                                <!-- „Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„É§„Éº -->
                                <rect width="100%" height="100%" fill="url(#fineGrid)" />
                                <rect width="100%" height="100%" fill="url(#majorGrid)" />
                                
                                <!-- ÈÄüÂ∫¶„Çæ„Éº„É≥„É©„Éô„É´ -->
                                <g id="speedLabels">
                                    <text x="8" y="20" fill="#ff4444" font-size="10" font-family="Consolas" font-weight="bold">4.0x</text>
                                    <text x="8" y="50" fill="#ff6666" font-size="10" font-family="Consolas">3.0x</text>
                                    <text x="8" y="80" fill="#ffaa66" font-size="10" font-family="Consolas">2.0x</text>
                                    <text x="8" y="110" fill="#ffffff" font-size="10" font-family="Consolas">1.5x</text>
                                    <text x="8" y="140" fill="#ffffff" font-size="11" font-family="Consolas" font-weight="bold">1.0x</text>
                                    <text x="8" y="170" fill="#aaffaa" font-size="10" font-family="Consolas">0.5x</text>
                                    <text x="8" y="200" fill="#aaff66" font-size="10" font-family="Consolas">0.2x</text>
                                    <text x="8" y="220" fill="#66ff66" font-size="10" font-family="Consolas">0.1x</text>
                                </g>
                                
                                <!-- „Çø„Ç§„É†„É©„Éô„É´ -->
                                <g id="timeLabels">
                                    <text x="40" y="235" fill="#ccc" font-size="9" font-family="Consolas">25%</text>
                                    <text x="100" y="235" fill="#ccc" font-size="9" font-family="Consolas">50%</text>
                                    <text x="160" y="235" fill="#ccc" font-size="9" font-family="Consolas">75%</text>
                                    <text x="240" y="235" fill="#ccc" font-size="9" font-family="Consolas">100%</text>
                                </g>
                                
                                <!-- ‰∏≠ÂøÉÂü∫Ê∫ñÁ∑ö -->
                                <line x1="0" y1="140" x2="280" y2="140" stroke="#666" stroke-width="2" stroke-dasharray="8,4" opacity="0.8" />
                                
                                <!-- „Éô„Ç∏„Ç®Êõ≤Á∑ö -->
                                <path id="speedCurvePath" d="M0,140 C70,140 70,140 140,140 S210,140 280,140" 
                                      fill="none" stroke="#4CAF50" stroke-width="4" filter="url(#glow)" />
                                
                                <!-- Âà∂Âæ°„Éè„É≥„Éâ„É´Á∑ö -->
                                <g id="controlHandles" opacity="0.6">
                                    <line id="handle1Line" x1="70" y1="140" x2="70" y2="140" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                    <line id="handle2Line" x1="140" y1="140" x2="140" y2="140" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                    <line id="handle3Line" x1="210" y1="140" x2="210" y2="140" stroke="#888" stroke-width="1" stroke-dasharray="3,2" />
                                </g>
                                
                                <!-- ÂÖ®„Ç≥„É≥„Éà„É≠„Éº„É´„Éù„Ç§„É≥„ÉàÔºà5ÁÇπÂà∂Âæ°Ôºâ -->
                                <g id="controlPoints">
                                    <!-- Â∑¶Á´Ø„Éù„Ç§„É≥„ÉàÔºàÈñãÂßãÁÇπÔºâ -->
                                    <circle id="controlPoint0" cx="0" cy="140" r="8" fill="#ff6b6b" stroke="#ffffff" stroke-width="2" cursor="move" 
                                            class="control-point endpoint" data-speed="1.0" />
                                    <!-- ‰∏≠ÈñìÂà∂Âæ°„Éù„Ç§„É≥„Éà -->
                                    <circle id="controlPoint1" cx="70" cy="140" r="8" fill="#ffffff" stroke="#4CAF50" stroke-width="3" cursor="move" 
                                            class="control-point" data-speed="1.0" />
                                    <circle id="controlPoint2" cx="140" cy="140" r="8" fill="#ffffff" stroke="#4CAF50" stroke-width="3" cursor="move" 
                                            class="control-point" data-speed="1.0" />
                                    <circle id="controlPoint3" cx="210" cy="140" r="8" fill="#ffffff" stroke="#4CAF50" stroke-width="3" cursor="move" 
                                            class="control-point" data-speed="1.0" />
                                    <!-- Âè≥Á´Ø„Éù„Ç§„É≥„ÉàÔºàÁµÇ‰∫ÜÁÇπÔºâ -->
                                    <circle id="controlPoint4" cx="280" cy="140" r="8" fill="#ff6b6b" stroke="#ffffff" stroke-width="2" cursor="move" 
                                            class="control-point endpoint" data-speed="1.0" />
                                </g>
                                
                                <!-- „É™„Ç¢„É´„Çø„Ç§„É†ÊÉÖÂ†±Ë°®Á§∫ -->
                                <g id="realtimeInfo" opacity="0" pointer-events="none">
                                    <rect x="200" y="10" width="70" height="40" rx="4" fill="rgba(0,0,0,0.8)" />
                                    <text id="realtimeSpeed" x="210" y="25" fill="#4CAF50" font-size="11" font-family="Consolas">1.0x</text>
                                    <text id="realtimeTime" x="210" y="40" fill="#ccc" font-size="9" font-family="Consolas">50%</text>
                                </g>
                            </svg>
                            
                            <!-- Á≤æÂØÜÂà∂Âæ°„Éë„Éç„É´ -->
                            <div class="curve-precision-panel">
                                <div class="precision-info">
                                    <span class="precision-label">Á≤æÂØÜÂà∂Âæ°:</span>
                                    <div class="precision-values">
                                        <div class="value-item">
                                            <label>P0:</label>
                                            <input type="number" id="p0Speed" min="0.1" max="4.0" step="0.05" value="1.0">
                                            <span>x</span>
                                        </div>
                                        <div class="value-item">
                                            <label>P1:</label>
                                            <input type="number" id="p1Speed" min="0.1" max="4.0" step="0.05" value="1.0">
                                            <span>x</span>
                                        </div>
                                        <div class="value-item">
                                            <label>P2:</label>
                                            <input type="number" id="p2Speed" min="0.1" max="4.0" step="0.05" value="1.0">
                                            <span>x</span>
                                        </div>
                                        <div class="value-item">
                                            <label>P3:</label>
                                            <input type="number" id="p3Speed" min="0.1" max="4.0" step="0.05" value="1.0">
                                            <span>x</span>
                                        </div>
                                        <div class="value-item">
                                            <label>P4:</label>
                                            <input type="number" id="p4Speed" min="0.1" max="4.0" step="0.05" value="1.0">
                                            <span>x</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="speed-curve-controls">
                            <button class="reset-button" id="resetSpeedCurve">Êõ≤Á∑ö„É™„Çª„ÉÉ„Éà</button>
                            <button class="apply-button" id="applySpeedCurve">ÈÄüÂ∫¶Êõ≤Á∑öÈÅ©Áî®</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ãÈÉ®: „Çø„Ç§„É†„É©„Ç§„É≥ -->
        <div class="timeline-panel">
            <h3>„Çø„Ç§„É†„É©„Ç§„É≥</h3>
            
            <!-- „Ç∑„Éº„ÇØ„Éê„Éº„Å®„Ç≥„É≥„Éà„É≠„Éº„É´ -->
            <div class="timeline-seekbar-container">
                <div class="playback-controls">
                    <button id="playBtn" class="control-btn">‚ñ∂Ô∏è</button>
                    <button id="pauseBtn" class="control-btn" style="display: none;">‚è∏Ô∏è</button>
                    <button id="stopBtn" class="control-btn">‚èπÔ∏è</button>
                </div>
                <div class="seekbar-container">
                    <input type="range" id="timelineSeekbar" class="timeline-seekbar" min="0" max="100" value="0">
                    <div class="time-display">
                        <span id="currentTimeDisplay">00:00</span>
                        <span>/</span>
                        <span id="totalTimeDisplay">00:00</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-content" id="timeline">
                <div class="timeline-ruler">
                    <div class="ruler-markers" id="rulerMarkers"></div>
                </div>
                <div class="timeline-track" id="timelineTrack">
                    <div class="timeline-placeholder">
                        <p>„Åì„Åì„Å´„ÇØ„É™„ÉÉ„Éó„Çí„Çª„ÉÉ„Éà„Åó„Å¶Á∑®ÈõÜ„ÇíÈñãÂßã</p>
                    </div>
                    <div class="playhead" id="playhead"></div>
                </div>
                <div class="timeline-controls">
                    <span class="timeline-info" id="timelineInfo">„Çª„ÉÉ„ÉàÂæÖÊ©ü‰∏≠...</span>
                    <div class="timeline-help">
                        <small>üí° „Éâ„É©„ÉÉ„Ç∞„Åß‰∏¶„Å≥Êõø„Åà | Ctrl+S: „Çª„ÉÉ„Éà | Space: ÂÜçÁîü/ÂÅúÊ≠¢ | ‚Üê‚Üí: „Éï„É¨„Éº„É†ÁßªÂãï</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- „Éï„Ç°„Ç§„É´ÂÖ•ÂäõÔºàÈùûË°®Á§∫Ôºâ -->
    <input type="file" id="fileInput" accept="video/*" style="display: none;" multiple>
    
    <script src="app.js"></script>
</body>
</html>