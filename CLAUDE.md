# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## プロジェクト概要

このリポジトリは Claude Code と Gemini CLI の協業ワークフローを定義するためのテンプレートとドキュメントを管理します。主な目的は、AI間の効果的な協業パターンを確立し、品質の高い技術的意思決定を支援することです。

**主要コンポーネント:**
- `CLAUDE.md`: Claude Code への協業指針
- `GEMINI.md`: Gemini CLI への協業ガイドライン  
- テスト動画ファイル: 協業パターンの実例やデモンストレーション

## Gemini CLI 連携

### トリガー
ユーザーが「Geminiと相談しながら進めて」（または類似表現）とリクエストした場合、Claude はセッション全体を通じて Gemini CLI と協業します。

### 協業時の Claude の役割
- **批判的評価者**: Gemini の提案を鵜呑みにせず、必ず検証・評価する
- **統合責任者**: 複数の視点を統合し、最終判断を行う
- **品質管理者**: 実装の実現可能性、保守性、パフォーマンスを評価

### 協業ワークフロー
1. **PROMPT 準備**: 最新の要件と議論要約を `$PROMPT` に格納
2. **Gemini 呼び出し** (バックグラウンド実行で自動進行):
   ```bash
   gemini <<EOF
   $PROMPT
   
   重要：以下の観点で複数の選択肢を提示してください：
   - 長所と短所を明確に
   - トレードオフを具体的に
   - 実装難易度の評価
   EOF
   ```
   ※ Claude は `run_in_background: true` でGeminiを呼び出し、結果を自動的に取得・評価します
3. **出力形式**:
   ```md
   **Gemini ➜**
   <Gemini からの応答>

   **Claude ➜**
   <評価フレームワークに基づく分析>
   ```

### 📊 Claude の評価フレームワーク
**Claude ➜** セクションは必ず以下の構造に従う：

```
## Gemini提案の評価
✅ **採用可能な要素**: [具体的な良い点]
⚠️ **技術的懸念**: [実装上の問題点やリスク]
🔄 **Claude の代替案**: [独自の第3の選択肢]

## 最終判断
- **採用方針**: [Gemini案/Claude案/折衷案]
- **根拠**: [なぜその判断に至ったか]
- **実装計画**: [具体的な次のステップ]
```

### ⚡ 鵜呑み防止ルール
1. **Gemini の提案をそのまま採用することは禁止**
2. **必ず技術的検証を行う**
3. **独自案の検討を義務化**

## 開発ガイドライン

### ファイル構成
- `CLAUDE.md`: Claude Code の協業設定（このファイル）
- `GEMINI.md`: Gemini CLI の役割定義と出力フォーマット規定
- `★テスト*.mp4`: 協業パターンのデモンストレーション動画

### 協業ドキュメント管理
- 両ファイルは常に同期を保つ必要がある
- フォーマット変更時は両方のファイルを更新する
- 新しい協業パターンが確立された場合、両ファイルに反映する

## 重要な注意事項

- ユーザーが明示的に要求しない限りファイルを作成しない
- 新規ファイル作成より既存ファイルの編集を常に優先する
- コードベース内の既存のコードパターンと規約に従う
- 特に指定がない限り、すべてのコード変更は後方互換性を維持する

## プロジェクト固有の指示

### Gemini CLI 環境要件
- `gemini` コマンドがシステムパスに存在することを前提とする
- Gemini CLI のレスポンス時間は通常10-30秒を想定
- バックグラウンド実行時は `BashOutput` ツールで結果を監視する

### 協業時の品質管理
- Gemini からの提案は必ず技術的妥当性を検証する
- 複数の選択肢が提示された場合、実装コストと長期的影響を評価する
- セキュリティ、パフォーマンス、保守性の観点から総合判断を行う

### このリポジトリでの作業
- 協業ワークフローの改善提案がある場合は、CLAUDE.md と GEMINI.md の両方を更新する
- 新しい協業パターンをテストする際は、結果を記録しドキュメントに反映する